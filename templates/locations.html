{% extends "base.html" %}

{% block title %}The Trompo King Locations - Find Us Near You{% endblock %}

{% block og_title %}The Trompo King - 3 Convenient Locations{% endblock %}

{% block content %}
<div class="locations-header">
    <h1>Find The Trompo King</h1>
    <p>Visit one of our 3 authentic Mexican food locations</p>
</div>

<div class="locations-container">
    <div class="locations-grid">
        {% for location in locations %}
        <div class="location-card" data-id="{{ location.id }}">
            <h2>{{ location.name }}</h2>
            <div class="location-info">
                <p class="location-address">
                    <strong>üìç Address:</strong><br>
                    {{ location.address }}
                </p>
                <p class="location-phone">
                    <strong>üìû Phone:</strong><br>
                    <a href="tel:{{ location.phone }}">{{ location.phone }}</a>
                </p>
                <p class="location-hours">
                    <strong>‚è∞ Hours:</strong><br>
                    {{ location.hours }}
                </p>
                <p class="location-description">
                    {{ location.description }}
                </p>
            </div>
            <div class="location-buttons">
                <button type="button" class="btn btn-secondary view-map" onclick="viewOnMap('{{ location.id | tojson }}')">View on Map</button>
                <a href="https://www.google.com/maps/search/{{ location.address }}" target="_blank" class="btn btn-primary">Directions</a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="map-container">
        <h2>Interactive Map</h2>
        <p class="map-info">Click on a location card to highlight it on the map</p>
        <div id="map"></div>
    </div>
</div>

<section class="locations-faq">
    <h2>Location FAQs</h2>
    <div class="faq-content">
        <div class="faq-item">
            <h3>Which location is closest to me?</h3>
            <p>We have three convenient locations: Downtown, Midtown, and Uptown. Use the interactive map above to find the one nearest you, or call us and we can help direct you!</p>
        </div>
        <div class="faq-item">
            <h3>Are all locations the same?</h3>
            <p>Yes! All three The Trompo King locations serve the same authentic menu with the same quality. Choose whichever is most convenient for you.</p>
        </div>
        <div class="faq-item">
            <h3>What parking is available?</h3>
            <p>All locations have dedicated parking. The Downtown location has a parking garage next door, Midtown has street and lot parking, and Uptown has a large parking lot.</p>
        </div>
        <div class="faq-item">
            <h3>Is there seating for large groups?</h3>
            <p>Yes! All locations can accommodate groups. For parties over 10 people, we recommend calling ahead to ensure seating availability.</p>
        </div>
        <div class="faq-item">
            <h3>Do you have outdoor seating?</h3>
            <p>Yes! Downtown has sidewalk seating, Midtown has a patio, and our new Uptown location features an expansive outdoor patio with seating for 50+.</p>
        </div>
        <div class="faq-item">
            <h3>Is WiFi available?</h3>
            <p>Yes, complimentary WiFi is available at all locations. Ask staff for the password when you visit.</p>
        </div>
    </div>
</section>

<section class="hours-comparison">
    <h2>Hours by Location</h2>
    <table class="hours-table">
        <thead>
            <tr>
                <th>Location</th>
                <th>Monday - Sunday</th>
                <th>Phone</th>
            </tr>
        </thead>
        <tbody>
            {% for location in locations %}
            <tr>
                <td>{{ location.name }}</td>
                <td>{{ location.hours }}</td>
                <td><a href="tel:{{ location.phone }}">{{ location.phone }}</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section class="cta-section">
    <h2>Ready to Visit?</h2>
    <p>Come experience authentic Mexican cuisine at one of our convenient locations!</p>
    <div class="cta-buttons">
        <a href="/contact" class="btn btn-primary">Contact Us</a>
        <a href="/" class="btn btn-secondary">Back to Home</a>
    </div>
</section>

<script type="text/javascript">
// Locations data (passed from Flask)
const locationsData = JSON.parse('{{ locations | tojson | safe }}');
let map;
let markers = [];
let selectedLocationId = null;

function initMap() {
    // Center of the city (adjust coordinates as needed)
    const cityCenter = { lat: 40.7580, lng: -73.9855 };
    
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: cityCenter,
        styles: [
            {
                "featureType": "all",
                "elementType": "labels.text.fill",
                "stylers": [{"color": "#333333"}]
            }
        ]
    });

    // Add markers for each location
    locationsData.forEach(location => {
        const marker = new google.maps.Marker({
            position: { lat: location.lat, lng: location.lng },
            map: map,
            title: location.name,
            label: location.id.toString()
        });

        const infoWindow = new google.maps.InfoWindow({
            content: `
                <div style="padding: 10px;">
                    <h3 style="margin: 0 0 5px 0;">${location.name}</h3>
                    <p style="margin: 5px 0;"><strong>Address:</strong> ${location.address}</p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> <a href="tel:${location.phone}">${location.phone}</a></p>
                    <p style="margin: 5px 0;"><strong>Hours:</strong> ${location.hours}</p>
                    <p style="margin: 5px 0;">${location.description}</p>
                </div>
            `
        });

        marker.addListener('click', () => {
            // Close all other info windows
            markers.forEach(m => {
                if (m.infoWindow) m.infoWindow.close();
            });
            infoWindow.open(map, marker);
        });

        marker.infoWindow = infoWindow;
        markers.push(marker);
    });
}

function viewOnMap(locationId) {
    const location = locationsData.find(l => l.id === locationId);
    if (location && map) {
        selectedLocationId = locationId;
        
        // Pan to location
        map.panTo({ lat: location.lat, lng: location.lng });
        map.setZoom(15);
        
        // Highlight the clicked card
        document.querySelectorAll('.location-card').forEach(card => {
            card.classList.remove('active');
        });
        document.querySelector(`[data-id="${locationId}"]`).classList.add('active');
        
        // Open info window
        const marker = markers[locationId - 1];
        if (marker && marker.infoWindow) {
            marker.infoWindow.open(map, marker);
        }
    }
}

// Initialize map when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Check if Google Maps API is loaded
    if (typeof google !== 'undefined' && google.maps) {
        initMap();
    } else {
        console.error('Google Maps API not loaded. Please add your API key to base.html');
        const mapDiv = document.getElementById('map');
        if (mapDiv) {
            mapDiv.innerHTML = '<div style="padding: 40px 20px; text-align: center; background: #f5f5f5; border-radius: 8px; color: #555;"><p style="margin: 10px 0;"><strong>üó∫Ô∏è Map Not Available</strong></p><p style="margin: 10px 0; font-size: 0.9em;">Add your Google Maps API key to see the interactive map.</p><p style="margin: 10px 0; font-size: 0.9em;">See IMPLEMENTATION_GUIDE.md for instructions.</p></div>';
        }
    }
});

// Make location cards clickable
document.querySelectorAll('.location-card').forEach(card => {
    card.addEventListener('click', function(e) {
        if (!e.target.closest('a') && !e.target.closest('button')) {
            const locationId = parseInt(this.getAttribute('data-id'));
            viewOnMap(locationId);
        }
    });
});
</script>

{% endblock %}
